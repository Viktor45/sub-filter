[EN](README_en.md) / [RU](README.md)  / [ZH](README_zh.md) 

æ­¤ç¿»è¯‘ç”±ç¥ç»ç½‘ç»œå®Œæˆï¼Œå¦‚æœ‰ä»»ä½•é”™è¯¯ï¼Œæ•¬è¯·è°…è§£ã€‚

- [sub-filter](#sub-filter)
  - [å®ƒèƒ½åšä»€ä¹ˆï¼Ÿ](#å®ƒèƒ½åšä»€ä¹ˆ)
  - [å¦‚ä½•ç¼–è¯‘ï¼Ÿ](#å¦‚ä½•ç¼–è¯‘)
  - [å¦‚ä½•è¿è¡Œï¼Ÿ](#å¦‚ä½•è¿è¡Œ)
    - [æ¨¡å¼ 1ï¼šHTTP æœåŠ¡å™¨ï¼ˆåŠ¨æ€å®æ—¶è¿‡æ»¤ï¼‰](#æ¨¡å¼-1http-æœåŠ¡å™¨åŠ¨æ€å®æ—¶è¿‡æ»¤)
      - [å®Œæ•´å‚æ•°ç¤ºä¾‹](#å®Œæ•´å‚æ•°ç¤ºä¾‹)
      - [æœ€ç®€ç¤ºä¾‹](#æœ€ç®€ç¤ºä¾‹)
    - [æ¨¡å¼ 2ï¼šå‘½ä»¤è¡Œæ¨¡å¼ï¼ˆä¸€æ¬¡æ€§å¤„ç†ï¼‰](#æ¨¡å¼-2å‘½ä»¤è¡Œæ¨¡å¼ä¸€æ¬¡æ€§å¤„ç†)
      - [å®Œæ•´å‚æ•°ç¤ºä¾‹](#å®Œæ•´å‚æ•°ç¤ºä¾‹-1)
      - [æœ€ç®€ç¤ºä¾‹](#æœ€ç®€ç¤ºä¾‹-1)
  - [å‚æ•°è¯´æ˜](#å‚æ•°è¯´æ˜)
  - [å¦‚ä½•æµ‹è¯•æ˜¯å¦æˆåŠŸï¼Ÿ](#å¦‚ä½•æµ‹è¯•æ˜¯å¦æˆåŠŸ)
    - [æœåŠ¡å™¨æ¨¡å¼](#æœåŠ¡å™¨æ¨¡å¼)
    - [å‘½ä»¤è¡Œæ¨¡å¼](#å‘½ä»¤è¡Œæ¨¡å¼)
  - [å¦‚ä½•åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ï¼Ÿ](#å¦‚ä½•åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨)
  - [Docker é•œåƒï¼ˆå·²å‡†å¤‡å¥½ï¼‰](#docker-é•œåƒå·²å‡†å¤‡å¥½)
  - [å¦‚ä½•è‡ªå·±æ„å»º Docker é•œåƒï¼Ÿ](#å¦‚ä½•è‡ªå·±æ„å»º-docker-é•œåƒ)
  - [å¦‚ä½•åœ¨ Docker ä¸­è¿è¡Œï¼Ÿ](#å¦‚ä½•åœ¨-docker-ä¸­è¿è¡Œ)
    - [ä½¿ç”¨ Docker](#ä½¿ç”¨-docker)
    - [ä½¿ç”¨ Podmanï¼ˆDocker çš„æ›¿ä»£å“ï¼‰](#ä½¿ç”¨-podmandocker-çš„æ›¿ä»£å“)
  - [åœ¨ Docker ä¸­ä½¿ç”¨ CLI æ¨¡å¼](#åœ¨-docker-ä¸­ä½¿ç”¨-cli-æ¨¡å¼)

# sub-filter

ç®€å•çš„è®¢é˜…è¿‡æ»¤å™¨

è¿™ä¸ªå·¥å…·æ˜¯ä¸€ä¸ªæ™ºèƒ½çš„ä»£ç†é“¾æ¥ï¼ˆVLESSã€VMessã€Trojanã€Shadowsocksã€Hysteria2ï¼‰è¿‡æ»¤å™¨ã€‚å®ƒä¼šä»å…¬å¼€çš„è®¢é˜…é“¾æ¥ä¸­è·å–æœåŠ¡å™¨åˆ—è¡¨ï¼Œé€ä¸ªæ£€æŸ¥æ¯ä¸ªæœåŠ¡å™¨æ˜¯å¦æ­£ç¡®ã€å®‰å…¨ï¼ˆæ¯”å¦‚ï¼Œå±è”½æœªåŠ å¯†çš„è¿æ¥æˆ–åŒ…å«æ•æ„Ÿè¯çš„åç§°ï¼‰ï¼Œè‡ªåŠ¨å‰”é™¤å¯ç–‘é¡¹ï¼Œæœ€åç»™ä½ ä¸€ä¸ªå¹²å‡€ã€å¯é ã€å¯ç›´æ¥åœ¨ Clashã€Sing-Boxã€è·¯ç”±å™¨æˆ–å…¶ä»–å®¢æˆ·ç«¯ä¸­ä½¿ç”¨çš„è®¢é˜…åˆ—è¡¨ã€‚

å¦‚æœä½ è¿˜ä¸æ˜ç™½ä¸ºä»€ä¹ˆè¦ç”¨å®ƒï¼Œè¯·é˜…è¯»æˆ‘ä»¬çš„ [FAQ](FAQ_zh.md).ã€‚

 âš ï¸ æœ¬å·¥å…·ä¸ä¼šæµ‹è¯•ä»£ç†æ˜¯å¦çœŸæ­£å¯ç”¨æˆ–é€Ÿåº¦å¿«æ…¢ã€‚å¦‚æœéœ€è¦è¿™ç§åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ https://github.com/kutovoys/xray-checker

---

## å®ƒèƒ½åšä»€ä¹ˆï¼Ÿ

âœ… æ£€æŸ¥ä»£ç†é“¾æ¥æ˜¯å¦æ ¼å¼æ­£ç¡®ï¼Œè‡ªåŠ¨åˆ é™¤ä¸å®‰å…¨æˆ–æŸåçš„é…ç½®  
âœ… æ ¹æ®é»‘åå•å…³é”®è¯ï¼ˆæ¯”å¦‚å¯ç–‘åŸŸåï¼‰è¿‡æ»¤æœåŠ¡å™¨  
âœ… è‡ªåŠ¨å±è”½å…¬å¼€è®¢é˜…ä¸­å¸¸è§çš„â€œèœœç½â€ï¼ˆhoneypotï¼Œå³ä¼ªè£…æˆä»£ç†çš„é™·é˜±æœåŠ¡å™¨ï¼‰  
âœ… ç¼“å­˜ç»“æœï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰ï¼Œé¿å…é¢‘ç¹è¯·æ±‚ã€èŠ‚çœæµé‡å’ŒæœåŠ¡å™¨èµ„æº  
âœ… ç”Ÿæˆæ ¼å¼è§„èŒƒã€æ ‡ç­¾æ¸…æ™°çš„å¹²å‡€è®¢é˜…

---

## å¦‚ä½•ç¼–è¯‘ï¼Ÿ

å¦‚æœä½ å·²å®‰è£… Goï¼ˆç‰ˆæœ¬ 1.25 æˆ–æ›´é«˜ï¼‰ï¼Œåœ¨ç»ˆç«¯è¿è¡Œï¼š

```
go build .
```

å®Œæˆåï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªå« `sub-filter` çš„æ–‡ä»¶â€”â€”è¿™å°±æ˜¯ä½ çš„ç¨‹åºï¼

---

## å¦‚ä½•è¿è¡Œï¼Ÿ

ç¨‹åºæœ‰ä¸¤ç§è¿è¡Œæ–¹å¼ï¼šHTTP æœåŠ¡å™¨æ¨¡å¼ æˆ– å‘½ä»¤è¡Œï¼ˆCLIï¼‰æ¨¡å¼ã€‚

### æ¨¡å¼ 1ï¼šHTTP æœåŠ¡å™¨ï¼ˆåŠ¨æ€å®æ—¶è¿‡æ»¤ï¼‰

å¯åŠ¨åä¼šç›‘å¬ä½ æŒ‡å®šçš„ç«¯å£ã€‚æ¯æ¬¡æœ‰äººè¯·æ±‚è®¢é˜…æ—¶ï¼Œå®ƒéƒ½ä¼šå®æ—¶è¿‡æ»¤å¹¶è¿”å›ç»“æœã€‚

#### å®Œæ•´å‚æ•°ç¤ºä¾‹

```
./filter 8000 1800 ./config/sub.txt ./config/bad.txt ./config/uagent.txt
```

#### æœ€ç®€ç¤ºä¾‹

```
./filter 8000 1800
```

ï¼ˆæ­¤æ—¶ç¨‹åºä¼šè‡ªåŠ¨ä» `./config/` æ–‡ä»¶å¤¹ä¸­è¯»å–é…ç½®æ–‡ä»¶ã€‚ï¼‰

### æ¨¡å¼ 2ï¼šå‘½ä»¤è¡Œæ¨¡å¼ï¼ˆä¸€æ¬¡æ€§å¤„ç†ï¼‰

ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰è®¢é˜…ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°ç³»ç»Ÿçš„ä¸´æ—¶æ–‡ä»¶å¤¹ `sub-filter-cache` ä¸­ã€‚é€‚åˆé…åˆå®šæ—¶ä»»åŠ¡ï¼ˆå¦‚ cronï¼‰æˆ–ç¦»çº¿ä½¿ç”¨ã€‚

#### å®Œæ•´å‚æ•°ç¤ºä¾‹

```
./filter --cli 1800 ./config/sub.txt ./config/bad.txt ./config/uagent.txt
```

#### æœ€ç®€ç¤ºä¾‹

```
./filter --cli
```

ï¼ˆä½¿ç”¨ `./config/` ä¸­çš„é»˜è®¤æ–‡ä»¶ï¼Œç¼“å­˜æ—¶é—´ä¸º 1800 ç§’ã€‚ï¼‰

> ğŸ’¡ å¤„ç†ç»“æœä¼šä¿å­˜ä¸º `sub-filter-cache/mod_1.txt`ã€`mod_2.txt` ç­‰æ–‡ä»¶ã€‚  
> è¢«æ‹’ç»çš„è¡Œä¼šå­˜å…¥ `sub-filter-cache/rejected_1.txt` ç­‰æ–‡ä»¶ã€‚

---

## å‚æ•°è¯´æ˜

| å‚æ•°         | è¯´æ˜                                                              |
| ------------ | ----------------------------------------------------------------- |
| `8000`       | HTTP æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£ï¼ˆä»…æœåŠ¡å™¨æ¨¡å¼ä½¿ç”¨ï¼‰                         |
| `1800`       | ç¼“å­˜æœ‰æ•ˆæœŸï¼ˆ1800 ç§’ = 30 åˆ†é’Ÿï¼‰                                   |
| `sub.txt`    | è®¢é˜…é“¾æ¥åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ª URLï¼‰                                      |
| `bad.txt`    | é»‘åå•å…³é”®è¯ï¼ˆæ¯”å¦‚å¯ç–‘åŸŸåï¼ŒåŒ…å«è¿™äº›è¯çš„æœåŠ¡å™¨ä¼šè¢«å±è”½ï¼‰          |
| `uagent.txt` | å…è®¸ä½¿ç”¨çš„å®¢æˆ·ç«¯åç§°ï¼ˆUser-Agentï¼‰ï¼Œå¦‚ `Clash`ã€`Shadowrocket` ç­‰ |

> ğŸ’¡ å¦‚æœä¸æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œç¨‹åºä¼šè‡ªåŠ¨ä» `./config/` æ–‡ä»¶å¤¹ä¸­åŠ è½½ã€‚

---

## å¦‚ä½•æµ‹è¯•æ˜¯å¦æˆåŠŸï¼Ÿ

### æœåŠ¡å™¨æ¨¡å¼

å°è¯•è·å– `sub.txt` ä¸­ç¬¬ä¸€è¡Œè®¢é˜…çš„è¿‡æ»¤ç»“æœï¼š

```
curl -H "User-Agent: Clash" "http://localhost:8000/filter?id=1"
```

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªå¹²å‡€çš„è®¢é˜…å†…å®¹ã€‚

> ğŸ’¡ å°æç¤ºï¼šç¡®ä¿ä½ çš„å®¢æˆ·ç«¯åç§°ï¼ˆå¦‚ `Clash`ï¼‰åœ¨ `uagent.txt` æ–‡ä»¶é‡Œï¼Œå¦åˆ™å¯èƒ½æ‹¿ä¸åˆ°è®¢é˜…ã€‚

### å‘½ä»¤è¡Œæ¨¡å¼

è¿è¡Œ `--cli` åï¼ŒæŸ¥çœ‹ `sub-filter-cache` æ–‡ä»¶å¤¹ï¼š

```
./filter --cli
```

ä½ ä¼šç›´æ¥çœ‹åˆ°ç”Ÿæˆå¥½çš„è®¢é˜…æ–‡ä»¶ï¼Œä¸éœ€è¦å¯åŠ¨æœåŠ¡å™¨ï¼

---

## å¦‚ä½•åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ï¼Ÿ

åœ¨ä½ çš„ä»£ç†å®¢æˆ·ç«¯é‡Œæ·»åŠ ç±»ä¼¼è¿™æ ·çš„è®¢é˜…é“¾æ¥ï¼š

```
http://ä½ çš„æœåŠ¡å™¨åœ°å€:ç«¯å£/filter?id=ç¼–å·
```

æ›¿æ¢è¯´æ˜ï¼š
- `ä½ çš„æœåŠ¡å™¨åœ°å€` â†’ ä½ çš„æ ‘è“æ´¾ã€è·¯ç”±å™¨æˆ–æœåŠ¡å™¨çš„ IP åœ°å€  
- `ç«¯å£` â†’ å¯åŠ¨æ—¶æŒ‡å®šçš„ç«¯å£ï¼ˆä¾‹å¦‚ `8000`ï¼‰  
- `ç¼–å·` â†’ `sub.txt` æ–‡ä»¶ä¸­çš„è¡Œå·ï¼ˆç¬¬ä¸€è¡Œä¸º `id=1`ï¼‰

> ğŸ”’ å¦‚æœä½ çš„æœåŠ¡å¯ä»¥ä»äº’è”ç½‘è®¿é—®ï¼Œå»ºè®®é€šè¿‡å¸¦ HTTPS çš„åå‘ä»£ç†ï¼ˆå¦‚ Nginxã€Caddy æˆ– Cloudflareï¼‰æ¥å¢å¼ºå®‰å…¨æ€§ã€‚

---

## Docker é•œåƒï¼ˆå·²å‡†å¤‡å¥½ï¼‰

æ”¯æŒ Linux `amd64` å’Œ `arm64` æ¶æ„ï¼Œä½¿ç”¨ `ko` æ„å»ºï¼š

```
ghcr.io/viktor45/sub-filter:latest
```

## å¦‚ä½•è‡ªå·±æ„å»º Docker é•œåƒï¼Ÿ

ä½¿ç”¨é¡¹ç›®ä¸­çš„ `Dockerfile` æ­£å¸¸æ„å»ºå³å¯ï¼š

```
docker build -t sub-filter .
```

## å¦‚ä½•åœ¨ Docker ä¸­è¿è¡Œï¼Ÿ

æ³¨æ„ï¼šç¼“å­˜ç›®å½•æ˜¯ `/tmp/sub-filter-cache`ï¼Œè¿™ä¸ `Dockerfile` ä¸­çš„ `distroless` é•œåƒè®¾ç½®ä¸€è‡´ã€‚

### ä½¿ç”¨ Docker

```
docker run -d \
  --name sub-filter \
  -p 8000:8000 \
  -v $(pwd)/config:/config:ro \
  -v $(pwd)/cache:/tmp/sub-filter-cache:rw \
  sub-filter \
  8000 1800
```

### ä½¿ç”¨ Podmanï¼ˆDocker çš„æ›¿ä»£å“ï¼‰

```
podman run -d --replace \
  --name sub-filter \
  -p 8000:8000 \
  -v $(pwd)/config:/config:ro,z \
  -v $(pwd)/cache:/tmp/sub-filter-cache:rw,z \
  sub-filter \
  8000 1800
```

> ğŸ“ è¿è¡Œå‰è¯·ç¡®ä¿ `./config` å’Œ `./cache` æ–‡ä»¶å¤¹å­˜åœ¨ï¼š
> ```
> mkdir -p ./config ./cache
> ```

---

## åœ¨ Docker ä¸­ä½¿ç”¨ CLI æ¨¡å¼

ä½ ä¹Ÿå¯ä»¥åœ¨ Docker å®¹å™¨ä¸­æ‰§è¡Œä¸€æ¬¡æ€§å¤„ç†ï¼š

```
docker run --rm \
  -v $(pwd)/config:/config:ro \
  -v $(pwd)/cache:/tmp/sub-filter-cache:rw \
  sub-filter \
  --cli 1800
```

å¤„ç†ç»“æœä¼šå‡ºç°åœ¨ä½ æœ¬åœ°çš„ `./cache` æ–‡ä»¶å¤¹ä¸­ã€‚