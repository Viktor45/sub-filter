[EN](README_en.md) / [RU](README.md)  / [ZH](README_zh.md) 

æ­¤ç¿»è¯‘ç”±ç¥ç»ç½‘ç»œå®Œæˆï¼Œå¦‚æœ‰ä»»ä½•é”™è¯¯ï¼Œæ•¬è¯·è°…è§£ã€‚

- [sub-filter](#sub-filter)
  - [åŠŸèƒ½äº®ç‚¹](#åŠŸèƒ½äº®ç‚¹)
  - [å¦‚ä½•ç¼–è¯‘ï¼Ÿ](#å¦‚ä½•ç¼–è¯‘)
  - [å¦‚ä½•è¿è¡Œï¼Ÿ](#å¦‚ä½•è¿è¡Œ)
    - [æ¨¡å¼ 1ï¼šHTTP æœåŠ¡å™¨ï¼ˆåŠ¨æ€è¿‡æ»¤ï¼‰](#æ¨¡å¼-1http-æœåŠ¡å™¨åŠ¨æ€è¿‡æ»¤)
      - [å®Œæ•´å‚æ•°ç¤ºä¾‹ï¼š](#å®Œæ•´å‚æ•°ç¤ºä¾‹)
      - [æœ€ç®€ç¤ºä¾‹ï¼š](#æœ€ç®€ç¤ºä¾‹)
    - [æ¨¡å¼ 2ï¼šCLIï¼ˆä¸€æ¬¡æ€§å¤„ç†ï¼‰](#æ¨¡å¼-2cliä¸€æ¬¡æ€§å¤„ç†)
      - [CLI æ¨¡å¼æ–°å¢åŠŸèƒ½ï¼š](#cli-æ¨¡å¼æ–°å¢åŠŸèƒ½)
      - [ç¤ºä¾‹ï¼šè¾“å‡ºåˆ°ç»ˆç«¯](#ç¤ºä¾‹è¾“å‡ºåˆ°ç»ˆç«¯)
      - [ç¤ºä¾‹ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶](#ç¤ºä¾‹ä½¿ç”¨é…ç½®æ–‡ä»¶)
  - [å‚æ•°è¯´æ˜](#å‚æ•°è¯´æ˜)
  - [æ–°å¢å‚æ•°ï¼š`--config` ä¸ `--stdout`](#æ–°å¢å‚æ•°--config-ä¸---stdout)
    - [`--stdout`ï¼ˆä»… CLI æ¨¡å¼ï¼‰](#--stdoutä»…-cli-æ¨¡å¼)
    - [`--config`](#--config)
      - [ç¤ºä¾‹ `config.yaml`ï¼š](#ç¤ºä¾‹-configyaml)
  - [å¦‚ä½•éªŒè¯æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ](#å¦‚ä½•éªŒè¯æ˜¯å¦æ­£å¸¸å·¥ä½œ)
    - [æœåŠ¡å™¨æ¨¡å¼ï¼š](#æœåŠ¡å™¨æ¨¡å¼)
    - [CLI æ¨¡å¼ï¼š](#cli-æ¨¡å¼)
  - [å¦‚ä½•åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ï¼Ÿ](#å¦‚ä½•åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨)
  - [é¢„æ„å»º Docker é•œåƒ](#é¢„æ„å»º-docker-é•œåƒ)
  - [å¦‚ä½•æ„å»º Docker é•œåƒï¼Ÿ](#å¦‚ä½•æ„å»º-docker-é•œåƒ)
  - [å¦‚ä½•åœ¨ Docker ä¸­è¿è¡Œï¼Ÿ](#å¦‚ä½•åœ¨-docker-ä¸­è¿è¡Œ)
    - [ä½¿ç”¨ Dockerï¼š](#ä½¿ç”¨-docker)
    - [ä½¿ç”¨ Podmanï¼ˆDocker æ›¿ä»£æ–¹æ¡ˆï¼‰ï¼š](#ä½¿ç”¨-podmandocker-æ›¿ä»£æ–¹æ¡ˆ)
  - [åœ¨ Docker ä¸­ä½¿ç”¨ CLI æ¨¡å¼](#åœ¨-docker-ä¸­ä½¿ç”¨-cli-æ¨¡å¼)

# sub-filter

ä¸€ä¸ªç®€å•çš„è®¢é˜…è¿‡æ»¤å™¨

è¯¥ç¨‹åºæ˜¯ä¸€ä¸ªæ™ºèƒ½çš„ä»£ç†æœåŠ¡å™¨é“¾æ¥ï¼ˆVLESSã€VMessã€Trojanã€Shadowsocksã€Hysteria2ï¼‰è¿‡æ»¤å™¨ã€‚å®ƒä¼šè·å–å…¬å¼€è®¢é˜…ï¼Œé€ä¸ªéªŒè¯æœåŠ¡å™¨çš„æ­£ç¡®æ€§ä¸å®‰å…¨æ€§ï¼ˆä¾‹å¦‚ï¼šé˜»æ­¢æœªåŠ å¯†çš„è¿æ¥ï¼Œæˆ–åç§°ä¸­åŒ…å«ç¦ç”¨å…³é”®è¯çš„æœåŠ¡å™¨ï¼‰ï¼Œå‰”é™¤æ‰€æœ‰å¯ç–‘å†…å®¹ï¼Œæœ€ç»ˆè¾“å‡ºä¸€ä»½å¹²å‡€ã€å¯ç”¨çš„åˆ—è¡¨â€”â€”å¯ç›´æ¥ç”¨äº Clashã€Sing-Boxã€è·¯ç”±å™¨åŠå…¶ä»–å®¢æˆ·ç«¯ã€‚

å¦‚æœæ‚¨ä¸æ¸…æ¥šä¸ºä½•éœ€è¦æ­¤å·¥å…·ï¼Œè¯·é˜…è¯» [FAQ](FAQ.md)ã€‚

âš ï¸ **æ³¨æ„**ï¼šæœ¬ç¨‹åº **ä¸æ£€æµ‹ä»£ç†çš„å¯ç”¨æ€§æˆ–å»¶è¿Ÿ**ã€‚å¦‚éœ€æ­¤åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ [xray-checker](https://github.com/kutovoys/xray-checker)ã€‚

---

## åŠŸèƒ½äº®ç‚¹

âœ… éªŒè¯ä»£ç†é“¾æ¥ï¼Œç§»é™¤ä¸å®‰å…¨æˆ–æŸåçš„é…ç½®  
âœ… æ ¹æ®å…³é”®è¯é»‘åå•ï¼ˆå¦‚å¯ç–‘åŸŸåï¼‰è¿‡æ»¤æœåŠ¡å™¨  
âœ… é˜»æ­¢å…¬å…±è®¢é˜…ä¸­å¶å°”å‡ºç°çš„èœœç½ï¼ˆhoneypotï¼‰  
âœ… ç¼“å­˜ç»“æœï¼ˆé»˜è®¤ 30 åˆ†é’Ÿï¼‰ï¼Œé¿å…é¢‘ç¹è¯·æ±‚é€ æˆç½‘ç»œæˆ–æœåŠ¡å™¨å‹åŠ›  
âœ… ç”Ÿæˆæ ¼å¼æ­£ç¡®ã€æè¿°æ¸…æ™°çš„è®¢é˜…å†…å®¹  
âœ… æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨  
âœ… CLI æ¨¡å¼å¯ç›´æ¥åœ¨ç»ˆç«¯è¾“å‡ºç»“æœï¼Œæ— éœ€ä¿å­˜æ–‡ä»¶

---

## å¦‚ä½•ç¼–è¯‘ï¼Ÿ

è‹¥æ‚¨å·²å®‰è£… Goï¼ˆç‰ˆæœ¬ 1.25 æˆ–æ›´é«˜ï¼‰ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œï¼š

```bash
go build .
```

å°†ç”Ÿæˆ `sub-filter` å¯æ‰§è¡Œæ–‡ä»¶â€”â€”å³æ‚¨çš„ç¨‹åºã€‚

---

## å¦‚ä½•è¿è¡Œï¼Ÿ

ç¨‹åºæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š**HTTP æœåŠ¡å™¨æ¨¡å¼** å’Œ **CLIï¼ˆå‘½ä»¤è¡Œï¼‰æ¨¡å¼**ã€‚

### æ¨¡å¼ 1ï¼šHTTP æœåŠ¡å™¨ï¼ˆåŠ¨æ€è¿‡æ»¤ï¼‰

å¯åŠ¨åç›‘å¬æŒ‡å®šç«¯å£ï¼Œæ¯æ¬¡æ”¶åˆ°è¯·æ±‚æ—¶å®æ—¶è¿‡æ»¤è®¢é˜…ã€‚

#### å®Œæ•´å‚æ•°ç¤ºä¾‹ï¼š

```bash
./sub-filter 8000 1800 ./config/sub.txt ./config/bad.txt ./config/uagent.txt
```

#### æœ€ç®€ç¤ºä¾‹ï¼š

```bash
./sub-filter 8000
```

æ­¤æ—¶ï¼š
- ç¼“å­˜æœ‰æ•ˆæœŸä¸º 1800 ç§’ï¼ˆ30 åˆ†é’Ÿï¼‰  
- ç¨‹åºè‡ªåŠ¨åœ¨ `./config/` ç›®å½•ä¸‹æŸ¥æ‰¾é…ç½®æ–‡ä»¶  
- è‹¥æ–‡ä»¶ç¼ºå¤±ï¼Œç¨‹åºä»ä¼šè¿è¡Œï¼Œä½†å¯¹åº”è§„åˆ™ä¸ºç©ºï¼ˆå¦‚ `bad.txt` ä¸å­˜åœ¨åˆ™ä¸è¿›è¡Œå…³é”®è¯è¿‡æ»¤ï¼‰

### æ¨¡å¼ 2ï¼šCLIï¼ˆä¸€æ¬¡æ€§å¤„ç†ï¼‰

ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰è®¢é˜…ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°ç³»ç»Ÿä¸´æ—¶ç›®å½• `sub-filter-cache`ï¼ˆå¯åŠ¨æ—¶ä¼šæ‰“å°å…·ä½“è·¯å¾„ï¼‰ã€‚é€‚ç”¨äºè‡ªåŠ¨åŒ–ã€å®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰æˆ–ç¦»çº¿ä½¿ç”¨ã€‚

#### CLI æ¨¡å¼æ–°å¢åŠŸèƒ½ï¼š

- **`--stdout`**ï¼šä¸ä¿å­˜æ–‡ä»¶ï¼Œç›´æ¥è¾“å‡ºåˆ°ç»ˆç«¯  
- **`--config`**ï¼šé€šè¿‡å•ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰æ‰€æœ‰å‚æ•°

#### ç¤ºä¾‹ï¼šè¾“å‡ºåˆ°ç»ˆç«¯

```bash
./sub-filter --cli --stdout
```

ç«‹å³çœ‹åˆ°æœ€ç»ˆè®¢é˜…å†…å®¹ï¼Œæ— éœ€ç”Ÿæˆæ–‡ä»¶ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶

```bash
./sub-filter --cli --config ./my-config.yaml
```

---

## å‚æ•°è¯´æ˜

| å‚æ•°         | è¯´æ˜                                                      |
| ------------ | --------------------------------------------------------- |
| `8000`       | HTTP æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼ˆä»…æœåŠ¡å™¨æ¨¡å¼ï¼‰                       |
| `1800`       | ç¼“å­˜æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰ï¼Œ1800 = 30 åˆ†é’Ÿ                          |
| `sub.txt`    | è®¢é˜…é“¾æ¥åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ª URLï¼‰                              |
| `bad.txt`    | ç¦æ­¢å‡ºç°çš„å…³é”®è¯ï¼ˆå¦‚å¯ç–‘åŸŸåï¼‰                            |
| `uagent.txt` | å…è®¸è®¿é—®çš„å®¢æˆ·ç«¯ User-Agentï¼ˆå¦‚ `Clash`ã€`Shadowrocket`ï¼‰ |

> ğŸ’¡ è‹¥æœªæŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œç¨‹åºé»˜è®¤åœ¨ `./config/` ç›®å½•ä¸‹æŸ¥æ‰¾ã€‚  
> è‹¥æŸæ–‡ä»¶ä¸å­˜åœ¨ï¼Œç¨‹åºä»ä¼šç»§ç»­è¿è¡Œï¼Œä½†è·³è¿‡ç›¸å…³è§„åˆ™ï¼ˆå¦‚æ—  `bad.txt` åˆ™ä¸è¿›è¡Œå…³é”®è¯è¿‡æ»¤ï¼‰ã€‚

---

## æ–°å¢å‚æ•°ï¼š`--config` ä¸ `--stdout`

### `--stdout`ï¼ˆä»… CLI æ¨¡å¼ï¼‰

ä¸ç”Ÿæˆ `mod_1.txt`ã€`mod_2.txt` ç­‰æ–‡ä»¶ï¼Œè€Œæ˜¯ç›´æ¥è¾“å‡ºåˆ°ç»ˆç«¯ã€‚é€‚åˆå¿«é€Ÿå¤åˆ¶æˆ–ä¼ é€’ç»™å…¶ä»–ç¨‹åºã€‚

ç¤ºä¾‹ï¼š

```bash
./sub-filter --cli --stdout > my-sub.txt
```

### `--config`

æ”¯æŒé€šè¿‡ **å•ä¸ªé…ç½®æ–‡ä»¶** å®šä¹‰æ‰€æœ‰å‚æ•°ï¼ˆæ”¯æŒ **YAMLã€JSON æˆ– TOML æ ¼å¼**ï¼‰ã€‚

#### ç¤ºä¾‹ `config.yaml`ï¼š

```yaml
cache_ttl: 3600
sources_file: "./my-subs.txt"
bad_words_file: "./my-blocklist.txt"
allowed_ua:
  - "Clash"
  - "happ"
bad_words:
  - "tracking"
  - "fake"
```

è‹¥æŸå­—æ®µæœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼š

| å­—æ®µ             | é»˜è®¤å€¼                             |
| ---------------- | ---------------------------------- |
| `cache_ttl`      | `1800`ï¼ˆ30 åˆ†é’Ÿï¼‰                  |
| `sources_file`   | `"./config/sub.txt"`               |
| `bad_words_file` | `"./config/bad.txt"`               |
| `uagent_file`    | `"./config/uagent.txt"`            |
| `cache_dir`      | Linux ä¸‹ä¸º `/tmp/sub-filter-cache` |

> ğŸ’¡ é…ç½®æ–‡ä»¶ç‰¹åˆ«é€‚åˆ Docker æˆ– systemd éƒ¨ç½²åœºæ™¯ã€‚

---

## å¦‚ä½•éªŒè¯æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ

### æœåŠ¡å™¨æ¨¡å¼ï¼š

è¯·æ±‚ `sub.txt` ä¸­ç¬¬ä¸€è¡Œå¯¹åº”çš„è¿‡æ»¤åè®¢é˜…ï¼š

```bash
curl -H "User-Agent: Clash" "http://localhost:8000/filter?id=1"
```

è‹¥é…ç½®æ­£ç¡®ï¼Œå°†è¿”å›å¹²å‡€çš„è®¢é˜…å†…å®¹ã€‚

> ğŸ’¡ æç¤ºï¼šè¯·ç¡®ä¿å®¢æˆ·ç«¯åç§°ï¼ˆå¦‚ `Clash`ï¼‰å·²åˆ—å…¥ `uagent.txt`ï¼Œå¦åˆ™å¯èƒ½æ— æ³•è·å–è®¢é˜…ã€‚

### CLI æ¨¡å¼ï¼š

è¿è¡Œåæ£€æŸ¥ `sub-filter-cache` ç›®å½•ï¼š

```bash
./sub-filter --cli
```

æ‚¨å°†çœ‹åˆ°å·²å¤„ç†å¥½çš„è®¢é˜…æ–‡ä»¶ï¼Œæ— éœ€å¯åŠ¨æœåŠ¡å™¨ã€‚

æˆ–ç›´æ¥è¾“å‡ºï¼š

```bash
./sub-filter --cli --stdout
```

---

## å¦‚ä½•åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ï¼Ÿ

åœ¨å®¢æˆ·ç«¯ä¸­æ·»åŠ å¦‚ä¸‹æ ¼å¼çš„è®¢é˜…é“¾æ¥ï¼š

```
http://æœåŠ¡å™¨IP:ç«¯å£/filter?id=ç¼–å·
```

æ›¿æ¢è¯´æ˜ï¼š
- `æœåŠ¡å™¨IP` â†’ æ‚¨çš„è·¯ç”±å™¨ã€æ ‘è“æ´¾æˆ–æœåŠ¡å™¨çš„ IP åœ°å€  
- `ç«¯å£` â†’ å¯åŠ¨æ—¶æŒ‡å®šçš„ç«¯å£ï¼ˆå¦‚ `8000`ï¼‰  
- `ç¼–å·` â†’ `sub.txt` ä¸­çš„è¡Œå·ï¼ˆç¬¬ä¸€è¡Œä¸º `id=1`ï¼‰

> ğŸ”’ **å®‰å…¨å»ºè®®**ï¼šè‹¥æœåŠ¡æš´éœ²åœ¨å…¬ç½‘ï¼Œè¯·åŠ¡å¿…é€šè¿‡åå‘ä»£ç†ï¼ˆå¦‚ Nginxã€Caddy æˆ– Cloudflareï¼‰å¯ç”¨ HTTPSã€‚

---

## é¢„æ„å»º Docker é•œåƒ

å·²ä¸º Linux `amd64` å’Œ `arm64` æ¶æ„æä¾›é•œåƒï¼Œä½¿ç”¨ [ko](.ko.yaml) æ„å»ºï¼š

```
ghcr.io/viktor45/sub-filter:latest
```

## å¦‚ä½•æ„å»º Docker é•œåƒï¼Ÿ

æ ‡å‡†æ–¹å¼ï¼ŒåŸºäº `Dockerfile`ï¼š

```bash
docker build -t sub-filter .
```

## å¦‚ä½•åœ¨ Docker ä¸­è¿è¡Œï¼Ÿ

æ³¨æ„ï¼š`distroless` é•œåƒä½¿ç”¨ `/tmp/sub-filter-cache` ä½œä¸ºç¼“å­˜ç›®å½•ã€‚

### ä½¿ç”¨ Dockerï¼š

```bash
docker run -d \
  --name sub-filter \
  -p 8000:8000 \
  -v $(pwd)/config:/config:ro \
  -v $(pwd)/cache:/tmp/sub-filter-cache:rw \
  sub-filter \
  8000 1800
```

### ä½¿ç”¨ Podmanï¼ˆDocker æ›¿ä»£æ–¹æ¡ˆï¼‰ï¼š

```bash
podman run -d --replace \
  --name sub-filter \
  -p 8000:8000 \
  -v $(pwd)/config:/config:ro,z \
  -v $(pwd)/cache:/tmp/sub-filter-cache:rw,z \
  sub-filter \
  8000 1800
```

> ğŸ“ å¯åŠ¨å‰è¯·ç¡®ä¿ç›®å½•å­˜åœ¨ï¼š
> ```bash
> mkdir -p ./config ./cache
> ```

---

## åœ¨ Docker ä¸­ä½¿ç”¨ CLI æ¨¡å¼

å¯æ‰§è¡Œä¸€æ¬¡æ€§å¤„ç†ï¼š

```bash
docker run --rm \
  -v $(pwd)/config:/config:ro \
  -v $(pwd)/cache:/tmp/sub-filter-cache:rw \
  sub-filter \
  --cli 1800
```

ç»“æœå°†å‡ºç°åœ¨æœ¬åœ° `./cache` ç›®å½•ä¸­ã€‚

æˆ–ç›´æ¥è¾“å‡ºåˆ°ç»ˆç«¯ï¼š

```bash
docker run --rm \
  -v $(pwd)/config:/config:ro \
  -v $(pwd)/cache:/tmp/sub-filter-cache:rw \
  sub-filter \
  --cli --stdout
```