# Конфигурация правил валидации прокси-подписок
# Соответствует логике оригинальных обработчиков

vless:
  required_params:
    - encryption
    - sni
  forbidden_values:
    security: ["none"]
    # Запретить пустой authority (распространённая ошибка)
    authority: [""]
  allowed_values:
    security: ["tls", "reality"]
    type: ["tcp", "ws", "httpupgrade", "grpc", "xhttp"]
    flow:
      - "xtls-rprx-vision"
      - "xtls-rprx-vision-udp443"
      - "xtls-rprx-vision-direct"
    # Опционально: разрешённые режимы для gRPC
    mode: ["gun", "multi"]
  conditional:
    # REALITY: pbk обязателен
    - when: { security: "reality" }
      require: ["pbk"]

    # gRPC: serviceName обязателен
    - when: { type: "grpc" }
      require: ["serviceName"]

    # WebSocket и производные: path обязателен
    - when: { type: "ws" }
      require: ["path"]
    - when: { type: "httpupgrade" }
      require: ["path"]
    - when: { type: "xhttp" }
      require: ["path"]
    - when: { type: "xhttp", mode: "packet" }
      require: []

vmess:
  required_params:
    - tls
  allowed_values:
    tls: ["tls"]
    net: ["tcp", "ws", "grpc", "httpupgrade", "h2"]
  conditional:
    - when: { net: "grpc" }
      require: ["serviceName"]

hysteria2:
  required_params:
    - obfs
    - obfs-password
  allowed_values:
    obfs: ["salamander"]

trojan:
  conditional:
    - when: { type: "grpc" }
      require: ["serviceName"]

# Shadowsocks не использует query-параметры — политика пустая
ss: {}
